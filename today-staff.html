<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Today’s Staff Live View</title>
<meta name="color-scheme" content="light dark">
<link rel="preconnect" href="https://script.google.com" crossorigin>
<style>
  :root {
    --bg: #0b1020; --card: #111827; --text: #f3f4f6; --muted: #94a3b8;
    --border: #334155; --in: #16a34a; --out: #dc2626;
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f6f7fb; --card:#fff; --text:#0f172a; --muted:#667085; --border:#e5e7eb; }
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
       background:var(--bg);color:var(--text);padding:20px;overflow-x:hidden;}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
  h1{font-size:28px;font-weight:900;}
  .muted{color:var(--muted);}
  .board{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;}
  table{width:100%;border-collapse:collapse;}
  th,td{padding:10px 12px;text-align:left;}
  th{font-size:12px;text-transform:uppercase;color:var(--muted);letter-spacing:.08em;}
  tr{border-bottom:1px solid var(--border);}
  .name{font-weight:800;}
  .status{font-weight:900;}
  .dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:8px;}
  .dot.in{background:var(--in);}
  .dot.out{background:var(--out);}
  footer{margin-top:10px;font-size:12px;color:var(--muted);}
</style>
</head>
<body>
  <header>
    <h1>Today’s Staff</h1>
    <div class="muted" id="updated">Loading…</div>
  </header>

  <div class="board">
    <table>
      <thead>
        <tr><th>Name</th><th>Status</th><th>Time In</th><th>Time Out</th></tr>
      </thead>
      <tbody id="body">
        <tr><td colspan="4" class="muted">Loading data…</td></tr>
      </tbody>
    </table>
  </div>

  <footer>
    Source: Teacher-YYYY-MM-DD sheet • Auto-refreshing every 5s
  </footer>

<script>
const ENDPOINT = 'https://script.google.com/macros/s/AKfycbzF4Hy0W2ZBbB6dOPRcT3PIKsEZekW2HtHuPAAp99jwUpasH7Iq1mMYCtQ35WEPfkiQQw/exec';
const REFRESH_MS = 5000;
const bodyEl = document.getElementById('body');
const updEl = document.getElementById('updated');

function fmtTime(t){ return (t||'').trim() || '—'; }
function statusDot(s){ return `<span class="dot ${s}"></span>${s.toUpperCase()}`; }

async function loadData(){
  try{
    const res = await fetch(`${ENDPOINT}?action=today&nocache=${Date.now()}`, {cache:'no-store'});
    const data = await res.json();
    updEl.textContent = `Last update: ${new Date().toLocaleTimeString()}`;
    const rows = (data.rows||[]).sort((a,b)=>{
      if(a.status!==b.status) return a.status==='in' ? -1 : 1;
      return a.lastName.localeCompare(b.lastName);
    });
    if(!rows.length){ bodyEl.innerHTML = `<tr><td colspan="4" class="muted">No staff signed in yet.</td></tr>`; return; }
    bodyEl.innerHTML = rows.map(r=>`
      <tr>
        <td class="name">${r.firstName} ${r.lastName}</td>
        <td class="status">${statusDot(r.status)}</td>
        <td>${fmtTime(r.timeIn)}</td>
        <td>${fmtTime(r.timeOut)}</td>
      </tr>`).join('');
  }catch(e){
    bodyEl.innerHTML = `<tr><td colspan="4" class="muted">Network error, retrying…</td></tr>`;
  }finally{
    setTimeout(loadData, REFRESH_MS);
  }
}

loadData();
</script>
</body>
</html>
