<!doctype html>
<meta charset="utf-8">
<title>Attendance Debug</title>
<body style="font-family: system-ui; max-width: 720px; margin: 2rem auto;">
  <h1>Attendance Debug</h1>
  <p>Endpoint: <code id="ep"></code></p>

  <h2>Search by name</h2>
  <input id="q" placeholder="type last name e.g. Fox" style="padding:8px;font-size:16px;width:60%">
  <button id="btnSearch">Search</button>
  <pre id="outSearch" style="background:#f7f7f7;padding:12px;"></pre>

  <h2>Submit Quick Pin</h2>
  <input id="pin" placeholder="enter 10-digit pin" style="padding:8px;font-size:16px;width:60%">
  <button id="btnPin">Submit Pin</button>
  <pre id="outPin" style="background:#f7f7f7;padding:12px;"></pre>

<script>
  const ENDPOINT = 'https://script.google.com/macros/s/AKfycbzF4Hy0W2ZBbB6dOPRcT3PIKsEZekW2HtHuPAAp99jwUpasH7Iq1mMYCtQ35WEPfkiQQw/exec';
  document.getElementById('ep').textContent = ENDPOINT;

  async function get(url) {
    const r = await fetch(url);
    const t = await r.text();
    return { ok: r.ok, status: r.status, text: t, json: tryJSON(t) };
  }
  async function post(url, data) {
    const r = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams(data).toString()
    });
    const t = await r.text();
    return { ok: r.ok, status: r.status, text: t, json: tryJSON(t) };
  }
  function tryJSON(s){ try{ return JSON.parse(s); } catch{ return null; } }

  document.getElementById('btnSearch').onclick = async () => {
    const q = document.getElementById('q').value.trim();
    const res = await get(ENDPOINT + '?action=search&q=' + encodeURIComponent(q));
    document.getElementById('outSearch').textContent = JSON.stringify(res, null, 2);
  };

  document.getElementById('btnPin').onclick = async () => {
    const pin = document.getElementById('pin').value.trim();
    const res = await post(ENDPOINT, { pin });
    document.getElementById('outPin').textContent = JSON.stringify(res, null, 2);
  };
</script>
